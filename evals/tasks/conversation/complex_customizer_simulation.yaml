# 复杂定制用户模拟测试
task:
  id: "sim-complex-customizer-001"
  name: "复杂定制用户点单模拟"
  description: |
    模拟一个对咖啡很挑剔、有很多定制要求的用户。
    测试系统是否能正确处理多个定制选项。

  simulation:
    user_persona: "complex_customizer"
    user_goal: "点一杯大杯冰燕麦拿铁，少糖，加浓缩，不要奶油"
    user_simulator: "gpt-4o-mini"
    max_turns: 10

  graders:
    # 最终订单状态检查
    - type: state_check
      expect:
        order:
          items:
            - product_name: "拿铁"
              size: "大杯"
              temperature: "冰"
              milk_type: "燕麦奶"
              sweetness: "少糖"
          status: "pending"

    # 约束验证
    - type: constraint_validation
      required: true

    # 对话质量 LLM 评分
    - type: llm_rubric
      model: "gpt-4o-mini"
      rubric: |
        评估复杂订单处理（各项 1-5 分）：
        1. 多项处理：是否正确处理多个定制要求
        2. 确认完整：下单前是否完整复述所有定制
        3. 额外需求：是否正确处理"加浓缩"等额外需求
        4. 排除项：是否正确处理"不要奶油"等排除项
        5. 订单准确：最终订单是否完全符合用户要求
      min_scores:
        多项处理: 4
        确认完整: 4
        订单准确: 4

    # 对话轮数限制
    - type: transcript
      max_turns: 7

  tracked_metrics:
    - n_turns
    - duration_ms

  metadata:
    category: capability
    priority: medium
    tags:
      - complex_scenario
      - customization
      - multi_slot
